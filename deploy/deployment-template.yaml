kind: "Template"
apiVersion: "v1"

parameters:
- name: APP_NAME
  description: "The name for the application."
  value: "hellouniverse"
- name: APP_URL
  description: "URL to expose the application on; autogenerated if left empty"
  value: ""
- name: REPLICAS
  description: "Number of application replicas"
  value: "1"

objects:
- kind: Service
  apiVersion: v1
  metadata:
    name: "${APP_NAME}"
    labels:
      app: hellouniverse
  spec:
    ports:
    - name: "http"
      port: 80
      targetPort: 5000 
    selector:
      deploymentConfig: "${APP_NAME}"

- kind: Route
  apiVersion: v1
  metadata:
    name: "${APP_NAME}"
    labels:
      app: hellouniverse
  spec:
    host: "${APP_URL}"
    to:
      kind: "Service"
      name: "${APP_NAME}"

- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: "${APP_NAME}"
    labels:
      app: hellouniverse
  spec:
    strategy:
      type: Rolling
    replicas: "${REPLICAS}"
    triggers:
    - type: ConfigChange
    paused: true
    template:
      metadata:
        name: "${APP_NAME}"
        labels:
          app: hellouniverse
          deploymentConfig: "${APP_NAME}"
      spec:
        containers:
        - name: hellouniverse
          image: " "
          imagePullPolicy: "Always"
          ports:
          - containerPort: 5000
          readinessProbe:
            timeoutSeconds: 3
            initialDelaySeconds: 1
            httpGet:
              path: /
              port: 5000
          livenessProbe:
            timeoutSeconds: 3
            initialDelaySeconds: 15 
            httpGet:
              path: /healthz
              port: 5000
          resources:
            requests:
              cpu: "30m"
              memory: "150Mi"
            limits:
              cpu: "30m"
              memory: "150Mi"
